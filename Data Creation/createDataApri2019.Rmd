---
title: "Create Portfolio App data (final version)"
output: 
  html_notebook: 
    number_sections: yes
---

##Data input

###File characteristics
1. Formats: All inputs must be in `.csv` format. It has been sent to me in `.xlsx` format in the past and I have converted that into .csv or loaded as excel sheet. But this version of the file will only take it in as a .csv file. In case the starting point is an `.xlsx` file convert it to `.csv`.
2. All new data must be placed in "data" folder with the following names
        

```{r}
rm(list = ls())
library(tidyverse); library(readxl); library(stringr)

##row/col names

rowLabelData <- read_csv("data/interventionTypes.csv")
colLabelData <- read_csv("data/jobTypes.csv")

## data
newData <- read_csv("data/rawJobsData.csv") %>% 
        select(1:23, 230:242) %>% 
        gather(key = "subColLabel", value = "count", 25:36) %>% 
        filter(!is.na(count)) %>% 
        mutate(count = 1) 


names(newData) <- c("projId", "projName", "cluster", "gP", "projType", "projFY", "projApproval", "projRegion", "projCountry", "countryClassification", "IBRDCommit", "IDACommit", "totalCommit", "projProductLineKey", "projProductLine", "projOutputKey", "projOutputType", "projStatus", "projContribGPs", "projCCSA", "objective", "description", "projURL", "subRowLabel", "subColLabel", "count")

newData <- newData %>% 
        group_by(projId) %>% 
        mutate(money = totalCommit/n()) %>% 
        ungroup() %>% 
        left_join(., colLabelData, by = c("subColLabel")) %>% 
        left_join(., rowLabelData, by = c("subRowLabel")) %>% 
        mutate(money = ifelse(is.na(money), 0, money),
               subColLabel = ifelse(subColLabel == "Entrepreneurs/self-employed", 
                                    "Entrepreneurs/ self-employed", 
                                    subColLabel)) %>% 
        write_csv(., path = "../data/appData-Apr-2019.csv")

write_csv(rowLabelData, "../data/rowLabels-Apr-2019.csv")
write_csv(colLabelData, "../data/colLabels-Apr-2019.csv")
```